# ì…ì‹¤ ì²´í¬ í•´ì£¼ì„¸ìš” !! ğŸ˜€

# ê¸ˆì¼ ìˆ˜ì—… ê³¼ì •
1. ì½”ë“œ ë¦¬íŒ©í† ë§
2. ìˆ˜ì • íŒŒíŠ¸ ì„¤ì • -> ë˜‘ê°™ì´ ëª¨ë‹¬ì°½ì´ ëœ¹ë‹ˆë‹¤.
  - íŠ¹ì • ì°¨ì— ì‚­ì œ ë²„íŠ¼ ë§Œë“  ê²ƒì²˜ëŸ¼ Edit ë²„íŠ¼ ë§Œë“¤ì–´ìš”.
  - ëª¨ë‹¬ ì°½ì´ ëœ¨ëŠ”ë°, ê·¸ê±´ ìƒì„± ë¶€ë¶„ì—ì„œ êµ¬í˜„í•œ ë°©ì‹ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í• ê²ë‹ˆë‹¤.
  - input ì°½ì— ê¸°ì¡´ ì°¨ì˜ ë°ì´í„°ê°€ ê·¸ëŒ€ë¡œ ë‚˜ì™€ìˆë„ë¡ í• ê²ë‹ˆë‹¤.
  - í•„ìš”í•œ ë¶€ë¶„ë§Œ ìˆ˜ì •ì„ í•˜ë©´, PUT ìš”ì²­ì„ ë³´ë‚´ë„ë¡ í• ê²ë‹ˆë‹¤.
  - DBê°€ ìˆ˜ì •ë˜ê³ , ë§ˆì°¬ê°€ì§€ë¡œ cacheì™€ ë‹¤ë¥¸ì§€ ì²´í¬í•´ì„œ ë¸Œë¼ìš°ì € ìµœì‹ í™”ë¥¼ í•˜ê²Œ ë ê²ë‹ˆë‹¤.

3. ì‡¼í•‘ë¦¬ìŠ¤íŠ¸ì—ì„œ í–ˆë˜ ê²ƒì²˜ëŸ¼ ëª‡ëª‡ HTML íƒœê·¸ë¥¼ muië¡œ ëŒ€ì²´í• ê²ë‹ˆë‹¤. Button / TextFieldë¡œ.
4. mui iconì„ ì ìš©

# Refactoring 
ê¸°ëŠ¥ì€ ë™ì¼í•˜ê²Œ ê°€ì ¸ê°€ë©´ì„œ ë‚´ë¶€ì˜ ë¡œì§ì„ ìˆ˜ì •(ê°œì„ )í•œ ë°©ì‹.

ìˆ˜ì • ê¸°ëŠ¥ì„ êµ¬í˜„í•  ë•Œ C ì—ì„œ ë§Œë“¤ì—ˆë˜ ëª¨ë‹¬ì°½ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í• ê²ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ Cì—ì„œ ë§Œë“  ê±¸ ê·¸ëƒ¥ ctrl + c / v í•´ì„œ ë³µì‚¬ ë¶™ì—¬ë„£ê¸°í•œë‹¤ë©´ ë™ì¼í•œ ê¸°ëŠ¥ì„ í•˜ëŠ” ì½”ë“œê°€ ì¤‘ë³µì ìœ¼ë¡œ ì‚¬ìš©ë ê²ë‹ˆë‹¤. ê·¸ë˜ì„œ ì•„ì˜ˆ ì»´í¬ë„ŒíŠ¸ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ ê·¸ê²ƒì„ Cì—ë„ ì“°ê³  Uì—ë„ ì“¸ ì˜ˆì •ì…ë‹ˆë‹¤.

TextFieldë¥¼ ìì²´ ì»´í¬ë„ŒíŠ¸ë¡œ ë¶„í• í•œ ë‹¤ìŒì— New Car / Edit í¼ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í• ê²ë‹ˆë‹¤.

components í´ë”ì— CarDialogContent.tsx ìƒì„±. -> ì´ˆê¸°í™”
í”„ë¡­ì„ ì´ìš©í•˜ì—¬ car ê°ì²´ì™€ handleChange í•¨ìˆ˜ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œ DialogFormPropsë¼ëŠ” ìƒˆë¡œìš´ ìë£Œí˜•ë„ ìƒì„±í• ê²ë‹ˆë‹¤.
ê·¼ë° ì–˜ëŠ” ëª¨ë‹¬(Dialog) ë‚´ì—ì„œë§Œ ì‚¬ìš©í• ê±°ë¼ types.tsì—ëŠ” ì“°ì§€ ì•Šì„ê²ë‹ˆë‹¤.

ì´ìƒì˜ ì§€ì‹œì‚¬í•­ì„ ì½”ë“œë¡œ êµ¬í˜„í•œ ê²ƒì´

```tsx
//CarDialogContent.tsx
import { Car } from "../types";

type DialogFormProps = {
  car: Car;
  handleChange: (event : React.ChangeEvent<HTMLInputElement>) => void;
}

export default function CarDialogContent({ car, handleChange } : DialogFormProps) {

  return (<></>);
}
```

ê·¸ë¦¬ê³  CarDialogContentì— AddCar ì»´í¬ë„ŒíŠ¸ì˜ `<DialogContent>` íƒœê·¸ ë¶€ë¶„ì„ ì „ì²´ ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ê³ ,
AddCarì—ì„œëŠ” DialogContent íƒœê·¸ë¥¼ ì „ì²´ ì‚­ì œí•©ë‹ˆë‹¤. ì´ë¥¼ CarDialogContentë¡œ ëŒ€ì²´í–ˆìŠµë‹ˆë‹¤.
ì˜ˆì‹œì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
ì£¼ì„ ë¶€ë¶„ì„ í’€ê³  ì‹¤í–‰ì‹œì¼œê°€ë©´ì„œ ë¹„êµí•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

```tsx
// AddCar.tsx
import { Dialog, DialogActions, DialogContent, DialogTitle } from "@mui/material";
import { Car } from "../types";
import { useState } from "react";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { addCar } from "../api/carapi";
import CarDialogContent from "./CarDialogContet";

export default function AddCar() {
  const [ open, setOpen ] = useState(false);
  const [ car, setCar ] = useState<Car>({
    brand: '',
    model: '',
    color: '',
    registrationNumber: '',
    modelYear: 0,
    price: 0,
  });
  const queryClient = useQueryClient();

  const { mutate } = useMutation(addCar, {
    onSuccess: () => {
      queryClient.invalidateQueries(['cars']);
    },
    onError: (err) => console.log(err),
  });

  // ìë™ì°¨ë¥¼ ì €ì¥í•˜ê³  ëª¨ë‹¬ í¼ì„ ë‹«ì„ ìˆ˜ ìˆë„ë¡ í• ê²ë‹ˆë‹¤.
  const handleSave = () => {
    mutate(car);
    setCar({
      brand: '',
      model: '',
      color: '',
      registrationNumber: '',
      modelYear: 0,
      price: 0,
    });
    handleClose();
  }


  const handleClickOpen = () => setOpen(true);

  const handleClose = () => setOpen(false);

  const handleChange = (event : React.ChangeEvent<HTMLInputElement>) => 
  {
    setCar({...car, [event.target.name]: event.target.value})
  }
  
  return(
    <>
      <button onClick={handleClickOpen}>New Car</button>
      <Dialog open={open} onClose={handleClose}>
        <DialogTitle>New Car</DialogTitle>
        <CarDialogContent car={car} handleChange={handleChange} />

        {/* <DialogContent>
          <input placeholder="Brand" name="brand" value={car.brand} onChange={handleChange} /><br />
          <input placeholder="Model" name="model" value={car.model} onChange={handleChange} /><br />
          <input placeholder="Color" name="color" value={car.color} onChange={handleChange} /><br />
          <input placeholder="Reg.nr" name="registrationNumber" value={car.registrationNumber} onChange={handleChange} /><br />
          <input placeholder="Year" name="modelYear" value={car.modelYear} onChange={handleChange} /><br />
          <input placeholder="Price" name="price" value={car.price} onChange={handleChange} /><br />
        </DialogContent> */}
        <DialogActions>
          <button onClick={handleClose}>Cancel | ì·¨ì†Œ</button>
          <button onClick={handleSave}>Save | ì €ì¥</button>
        </DialogActions>
      </Dialog>
    </>
  );
}
```

# ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€í•˜ê¸°

Cì˜ ê²½ìš°ì—ëŠ” ì—†ëŠ” ì°¨ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— Carlist ì»´í¬ë„ŒíŠ¸ì— New Car | ì¶”ê°€ ë²„íŠ¼ì´ ìˆì—ˆìŠµë‹ˆë‹¤.
ê·¸ëŸ°ë° Uì˜ ê²½ìš°ì—ëŠ” ìˆëŠ” ì°¨ë¥¼ ìˆ˜ì •í•˜ê¸° ë•Œë¬¸ì— ì—”ë“œí¬ì¸íŠ¸ì— `/api/cars/{id}`ê°€ ìˆì„ê²ë‹ˆë‹¤.
ê·¸ë˜ì„œ ê° rowì— Edit ë²„íŠ¼ì„ ì¶”ê°€í•˜ê³ , ê·¸ Edit ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ì‚¬ìš©ìê°€ ê¸°ì¡´ ìë™ì°¨ë¥¼ í¸ì§‘í•˜ê³  ë³€ê²½ ì‚¬í•­ì„ ì €ì¥í•  ìˆ˜ ìˆëŠ” ëª¨ë‹¬ í¼ì´ ëœ° ìˆ˜ ìˆë„ë¡ ì‘ì„±í• ê²ë‹ˆë‹¤.

components í´ë”ì— EditCar.tsx ìƒì„±í•˜ê³  ì´ˆê¸°í™”í• ê²ë‹ˆë‹¤.
ê·¸ë¦¬ê³  EditCar ì»´í¬ë„ŒíŠ¸ì— CarResponse ìë£Œí˜•ì˜ ë°ì´í„°ê°€ ì „ë‹¬ë˜ì–´ì•¼ê² ë„¤ìš”(ì´ë¯¸ ë§Œë“¤ì–´ì§„ ì°¨ë¥¼ ìˆ˜ì •í•˜ë‹ˆê¹Œ Carê°€ ì•„ë‹ˆë¼ CarResponseì…ë‹ˆë‹¤).
ê·¸ë˜ì„œ ì°¨ì— ëŒ€í•œ ìƒíƒœë„ ì‚¬ìš©í•˜ê²Œ ë ê²ë‹ˆë‹¤. ê·¼ë° ìˆ˜ì •í•  ë•ŒëŠ” _link.self.hrefê°™ì€ê±´ ìˆ˜ì • ì•ˆí•˜ì£ . ê·¸ë˜ì„œ Carë„ ì”ë‹ˆë‹¤.

Edit ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ Dialog ì»´í¬ë„ŒíŠ¸ê°€ í¼ì³ì ¸ì•¼í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ê·¸ì €ê»˜ë‘ ì–´ì œ ë°°ìš´ ê²ƒì²˜ëŸ¼ open ìƒíƒœë¥¼ ì •ì˜í•´ì•¼ê² ë„¤ìš”.

ì •ì˜ë„ í–ˆê³ , ê·¸ëŸ¬ë©´ car ì •ë³´ê°€ ì…ë ¥ë˜ëŠ” ë¶€ë¶„ì´ handleClickOpenì´ë¼ëŠ” ë…¼ë¦¬ì ì¸ ì„¤ê³„ì— ë”°ë¼ì„œ ì™„ì„±ëœ
EditCar.tsxëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```tsx
//EditCar.tsx
import { useState } from "react";
import { Dialog,DialogActions, DialogTitle } from "@mui/material";
import { Car, CarResponse } from "../types";
import CarDialogContent from "./CarDialogContet";

type FormProps = {
  cardata: CarResponse
}

export default function EditCar({ cardata } : FormProps) {
  const [ open, setOpen ] = useState(false);
  const [ car, setCar ] = useState<Car>({
    brand: '',
    model: '',
    color: '',
    registrationNumber: '',
    modelYear: 0,
    price: 0,
  });

  const handleClickOpen = () => {
    setCar({
      brand: cardata.brand,
      model: cardata.model,
      color: cardata.color,
      registrationNumber: cardata.registrationNumber,
      modelYear: cardata.modelYear,
      price: cardata.price
    })
    
    setOpen(true);
  }

  const handleClose = () => setOpen(false);

  const handleSave = () => {
    setOpen(false);
  }

  const handleChange = (event : React.ChangeEvent<HTMLInputElement>) => 
    {
      setCar({...car, [event.target.name]: event.target.value})
    }
  
  return(
    <>
      <button onClick={handleClickOpen}>Edit</button>
      <Dialog open={open} onClose={handleClose}>
        <DialogTitle>Edit Car | ì°¨ëŸ‰ ìˆ˜ì •í•˜ê¸°</DialogTitle>
        <CarDialogContent car={car} handleChange={handleChange} />
        <DialogActions>
          <button onClick={handleClose}>Cancel | ì·¨ì†Œ</button>
          <button onClick={handleSave}>Save | ì €ì¥</button>
        </DialogActions>
      </Dialog>
    </>
  );
}
```

ì´ì œ Carlist ì»´í¬ë„ŒíŠ¸ì— ì‚­ì œ ë²„íŠ¼ ì¶”ê°€í•œ ê²ƒì²˜ëŸ¼ ìˆ˜ì • ë²„íŠ¼ì„ ì¶”ê°€í• ê²ë‹ˆë‹¤.
ê·¸ëŸ´ëŸ¬ë©´ columnsë¥¼ ìˆ˜ì •í•´ì•¼ê² ë„¤ìš”.
ê·¸ëŸ¬ë©´ ì‚¬ì‹¤ ì‚­ì œ ë²„íŠ¼ì— ì‘ì„±í•œ ë°©ì‹ì„ ì´ìš©í•˜ê²Œ ëœë‹¤ë©´ ê±°ì˜ ìœ ì‚¬í•˜ê²Œ í™”ë©´ì„ ë§Œë“¤ ìˆ˜ëŠ” ìˆì„ê²ë‹ˆë‹¤.

```tsx
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { getCars, deleteCar } from "../api/carapi";
import { DataGrid, GridColDef, GridCellParams } from "@mui/x-data-grid";
import { Snackbar } from "@mui/material";
import { useState } from "react";
import AddCar from "./AddCar";
import EditCar from "./EidtCar";

export default function Carlist() {
  const queryClient = useQueryClient();

  const [ open, setOpen ] = useState(false);

  const { data, error, isSuccess } = useQuery({
    queryKey: ['cars'],
    queryFn: getCars
  });

  const { mutate } = useMutation(deleteCar, {
    onSuccess: () => {
      setOpen(true);
      queryClient.invalidateQueries({queryKey: ['cars']});
    },
    onError: (err) => {
      console.log(err);
    },
  })


  const columns: GridColDef[] = [
    {field: 'brand', headerName: 'Brand', width: 200},
    {field: 'model', headerName: 'ëª¨ë¸ëª…', width: 200},
    {field: 'color', headerName: 'Color', width: 200},
    {field: 'registrationNumber', headerName: 'ë“±ë¡ë²ˆí˜¸', width: 150},
    {field: 'modelYear', headerName: 'Model Year', width: 150},
    {field: 'price', headerName: 'ê°€ê²©', width: 150},
    {
      field: 'edit',
      headerName: 'ìˆ˜ì •',
      width: 70,
      sortable: false,
      filterable: false,
      disableColumnMenu: true,
      renderCell: (params: GridCellParams) => <EditCar cardata={params.row}/>
    },
    {
      field: 'delete',
      headerName: 'ì‚­ì œ',
      width: 70,
      sortable: false,
      filterable: false,
      disableColumnMenu: true,
      renderCell: (params: GridCellParams) => (
        <button onClick={() => {
            if(window.confirm(`${params.row.brand}ì˜ ${params.row.model} ìë™ì°¨ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
              mutate(params.row._links.self.href);
            }
          }}
        >
          Delete
        </button>
      ),
    },
  ]


  if (!isSuccess) {
    return <span>Loading ... ğŸ’¨</span>
  }

  else if (error) {
    return <span>ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤ ... ğŸ˜ª</span>
  }

  else {
    return(
      <>
        <AddCar />
        <DataGrid 
          rows={data}
          columns={columns}
          disableRowSelectionOnClick = {true}
          getRowId={ row => row._links.self.href}
        />
        <Snackbar 
          open={open}
          autoHideDuration={2000}
          onClose={() => setOpen(false)}
          message='ìë™ì°¨ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'
        />
      </>

    );
  } 
}
```

ì´ìƒì˜ ì½”ë“œë¥¼ í†µí•´ ì´ì œ Edit ë²„íŠ¼ì„ ëˆ„ë¥´ê²Œ ë˜ë©´ ëª¨ë‹¬ì°½ì´ ëœ¨ê³  ìˆ˜ì •ì„ í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
ë‹¤ë§Œ í˜„ì¬ ìƒí™©ì—ì„œëŠ” í™”ë©´ë§Œ ê·¸ëŸ´ë¿ì´ê³  ì‹¤ì œ DB ìƒì—ì„œì˜ ë³€ê²½ì´ ì¼ì–´ë‚˜ì§€ ì•Šê³  ìˆìŠµë‹ˆë‹¤.
ì´ ë¶€ë¶„ì„ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” axios.put ìš”ì²­ì„ í•´ì•¼ë§Œ í•©ë‹ˆë‹¤.
carapi.tsì— ì‘ì„±ì„ í–ˆì—ˆìŠµë‹ˆë‹¤.

```ts
// types.ts
export type CarEntry = {
  car: Car;
  url: string;
}
```

ìë™ì°¨ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ë ¤ë©´ http://localhost:8080/api/cars/{id} URLë¡œ PUT ìš”ì²­ì„ ë³´ë‚´ì•¼ë§Œ í•©ë‹ˆë‹¤. ì € ë§í¬ëŠ” _ì‚­ì œ_ ê¸°ëŠ¥ì—ì„œì˜ ë§í¬ì™€ ë™ì¼í•©ë‹ˆë‹¤.
ê·¼ë° ìš”ì²­ ë³¸ë¬¸ì—ëŠ” ìˆ˜ì •ëœ ìë™ì°¨ ê°ì²´ì™€ ìƒì„± ê¸°ëŠ¥ì—ì„œ ì„¤ì •í•œ 'Content-Type': 'application/json' í—¤ë”ê°€ í¬í•¨ë©ë‹ˆë‹¤.
ê·¸ë¦¬ê³  ìˆ˜ì • ê¸°ëŠ¥ì„ ìœ„í•´ì„œëŠ” ìƒˆë¡œìš´ ìë£Œí˜•ë„ í•„ìš”í•©ë‹ˆë‹¤.
ê·¸ë˜ì„œ ì´ìƒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ CarEntry ìë£Œí˜•ì„ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.
ê·¸ ë‹¤ìŒì—ëŠ” carapi.tsì— updateCar í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ê² ìŠµë‹ˆë‹¤.

# React MUIë¡œ frontend ê¾¸ë¯¸ê¸°

Button ì»´í¬ë„ŒíŠ¸ë¥¼ ì´ìš©í•˜ì—¬ ë²„íŠ¼ì— ìŠ¤íƒ€ì¼ ì§€ì •
muiì•„ì´ì½˜ê³¼ IconButton ì»´í¬ë„ŒíŠ¸ë„ ì‚¬ìš©
input íƒœê·¸ëŠ” TextField

## MUI Button ì»´í¬ë„ŒíŠ¸ ì´ìš©
í˜„ì¬ ì €í¬ëŠ” AppBar / Dialog ë“±ì˜ MUIë¥¼ ì‚¬ìš©í•˜ê³  ìˆì§€ë§Œ ì—¬ì „íˆ html íƒœê·¸ë„ ì‚¬ìš©ì¤‘ì…ë‹ˆë‹¤.
ì¼ë‹¨ì€ button íƒœê·¸ë¥¼ MUIì˜ Button ì»´í¬ë„ŒíŠ¸ë¡œ ëŒ€ì²´í•´ë³´ê² ìŠµë‹ˆë‹¤.

EditCar ì»´í¬ë„ŒíŠ¸ì˜ `<button>`ì„ ì „ë¶€ Button ì»´í¬ë„ŒíŠ¸ë¡œ ëŒ€ì²´í•˜ì‹œì˜¤.